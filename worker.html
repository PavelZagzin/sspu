<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Worker Window</title>
  </head>
  <body></body>
  <script>
    const electron = require('electron');
    const path = require('path');
    const { dialog } = require('electron').remote;
    const { shell, ipcRenderer } = electron;
    const dataFileController = require('./controllers/dataFileController');
    const productController = require('./controllers/productController');
    const systemController = require('./controllers/systemController');
    const partController = require('./controllers/partController');
    const reportController = require('./controllers/reportController');
    const serialController = require('./controllers/serialController');

    ipcRenderer.on('get-partsurfer-data', async () => {
      try {
        await productController.getProductDataFromPartSurfer();
        await serialController.getSerialDataFromPartSurfer();
        await partController.getFieldEquivFromPartSurfer();
      } catch (error) {
        dialog.showErrorBox(error.name, error.message);
      } finally {
        ipcRenderer.send('finishedTask');
      }
    });

    ipcRenderer.on('generate-reports', async () => {
      try {
        const outFiles = await reportController.generateReports();

        if (outFiles && outFiles.length) {
          shell.openItem(path.dirname(outFiles[0]));
        }
      } catch (error) {
        dialog.showErrorBox(error.name, error.message);
      } finally {
        ipcRenderer.send('finishedTask');
      }
    });

    ipcRenderer.on('import-files', async () => {
      try {
        await dataFileController.importFiles();
      } catch (error) {
        dialog.showErrorBox('Error', error.message);
      } finally {
        ipcRenderer.send('finishedTask');
      }
    });

    ipcRenderer.on('clear-database', async () => {
      try {
        await dataFileController.clearDatabase();
      } catch (error) {
        dialog.showErrorBox(error.name, error.message);
      } finally {
        ipcRenderer.send('finishedTask');
      }
    });
  </script>
</html>
